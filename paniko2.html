<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scatter Plot - Chart Eight</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Include all your CSS exactly as provided */
    /* START OF CSS */
    * {
        font-family: "Poppins", sans-serif;
        font-weight: 300;
    }

    body {
        background-color: #FFFAF4;
        color: #333;
        margin: 20px;
    }

    p{ font-size: 15px; }

    h2 {
        font-size: 40px !important;
        padding: 0.5% 0 2% 0;
        text-align: center;
        color: #2c3e50;
        margin-bottom: 20px;
    }

    h3 {
        font-size:25px;
        padding: 0.5% 0 2% 0;
    }

    h5 {
        font-size: 1rem;
        padding-top:2%;
        font-family: "Caveat", cursive !important;
        text-transform: uppercase
    }

    .chart_container {
        background-color: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        overflow-x: auto;
        overflow: visible;
    }

    .controls {
        text-align: center;
        margin-bottom: 20px;
    }

    .controls label {
        font-size: 1.1em;
        margin-right: 10px;
    }

    .controls select {
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1em;
        background-color: #f9f9f9;
        cursor: pointer;
    }

    .axis text {
        font-size: 12px;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .value-label {
        font-weight: bold;
    }

    .cavText {
        font-size: 1rem;
        font-family: "Caveat", cursive;
    }

    svg {
        display: block;
        margin: auto;
        width: 900px;
        height: 500px;
    }

    .legend {
        font-size: 12px;
    }

    .legend-item {
        cursor: pointer;
    }

    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px;
        border-radius: 4px;
        font-size: 12px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
    }
    /* END OF CSS */
  </style>
</head>
<body>

  <div class="chart_container">
    <h4 class="cavText">Popular foods and their alternatives</h4>
    <h3>Are there any alternatives, to some of those popular foods, with a lower environmental cost?</h3>
    <p>Select an environmental factor to compare against food prices.</p>
    
    <div class="controls">
      <label for="theme-eight">Select one</label>
      <select id="theme-eight">
        <option value="co2">CO₂ Emissions</option>
        <option value="water">Water Usage</option>
      </select>
    </div>

    <svg id="chartEight" width="900" height="500"></svg>
    <div class="tooltip"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const svg = d3.select("#chartEight");
      const width = +svg.attr("width");
      const height = +svg.attr("height");
      const margin = { top: 40, right: 40, bottom: 60, left: 80 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const tooltip = d3.select(".tooltip");

      let data = [];

      d3.json("final_data/game_data.json").then(rawData => {
        data = Object.keys(rawData).map(item => {
          return {
            name: item,
            water: rawData[item].water,
            co2: rawData[item].carbon,
            price: rawData[item].cost
          };
        }).filter(d => d.water != null && d.co2 != null && d.price != null);

        drawScatter("co2");

        d3.select("#theme-eight").on("change", function () {
          drawScatter(this.value);
        });
      });

      function drawScatter(theme) {
        svg.selectAll("*").remove();

        const g = svg.append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        const xKey = theme === "water" ? "water" : "co2";
        const xLabel = theme === "water" ? "Liters / KG" : "kg CO₂ eq / KG";

        const x = d3.scaleLinear()
          .domain([0, d3.max(data, d => d[xKey]) || 0])
          .nice()
          .range([0, innerWidth]);

        const y = d3.scaleLinear()
          .domain([0, d3.max(data, d => d.price) || 0])
          .nice()
          .range([innerHeight, 0]);

        g.append("g")
          .attr("transform", `translate(0, ${innerHeight})`)
          .call(d3.axisBottom(x));

        g.append("g")
          .call(d3.axisLeft(y));

        // Axes labels
        g.append("text")
          .attr("x", innerWidth / 2)
          .attr("y", innerHeight + 40)
          .attr("text-anchor", "middle")
          .style("font-size", "14px")
          .text(xLabel);

        g.append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", -50)
          .attr("x", -innerHeight / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "14px")
          .text("Price (€/KG)");

        // Dots
        g.selectAll("circle")
          .data(data)
          .enter()
          .append("circle")
          .attr("cx", d => x(d[xKey]))
          .attr("cy", d => y(d.price))
          .attr("r", 7)
          .attr("fill", "#66C2A5")
          .attr("stroke", "#333")
          .attr("stroke-width", 1.2)
          .on("mouseover", function(event, d) {
            tooltip.transition()
              .duration(200)
              .style("opacity", 1);
            tooltip.html(`${d.name}<br/>${xLabel}: ${d[xKey]}<br/>Price: €${d.price}`)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          })
          .on("mouseout", function() {
            tooltip.transition()
              .duration(500)
              .style("opacity", 0);
          });
      }
    });
  </script>

</body>
</html>